# For local customization, add a file to ~/.profile.local
# We will export that at the end of this file.

# Brent's show branch on prompt
function parse_git_dirty {
  [[ $(git status 2> /dev/null | tail -n1) != "nothing to commit (working directory clean)" ]] && echo ""
}

function parse_git_branch {
  git branch --no-color 2> /dev/null | sed -e '/^[^*]/d' -e "s/* \(.*\)/[\1$(parse_git_dirty)]/"
}

export PAGER='less'
export EDITOR='atom --wait'
export PS1='\u@\h:\[\033[0;31m\]\w\[\033[0;33m\]$(parse_git_branch)\[\e[0m\]$ '

# Shell
alias ls='ls --color'
alias less='less -R'
alias clr="find . -name '*.rej' -or -name '*.orig' -or -name '*~' -or -name '*.lock' -and -not -name 'Gemfile.lock' | xargs rm -f"
alias emacs='emacs -nw'

# Mac
if [[ FreeBSD == $(uname) ]] || [[ Darwin == $(uname) ]] ; then
  alias ls='ls -G'
  alias updatedb='sudo /usr/libexec/locate.updatedb'
fi

# Rails
alias r='rake'
alias b='bundle exec'
alias ss='script/server'
alias sc='script/console'
alias sb='script/bootstrap'
alias dbm='rake db:migrate db:test:prepare'
alias t='testrb'
alias testlog='touch log/test.log; less +F log/test.log; rm log/test.log'

# Heroku
function h { heroku ${@:1:($#-1)} --app ${@: -1} --account jch; }

# Add test to Ruby load path
export RUBYLIB=test

# RVM
[[ -s $HOME/.rvm/scripts/rvm ]] && source $HOME/.rvm/scripts/rvm

# Git
alias d="git diff --cached"
alias gm="git merge"
alias gh="github"
alias ph="git push -u"
alias pl="git pull"
alias fe="git fetch"
alias ch="git rev-parse HEAD | pbcopy; git show"

# hub tab-completion script for bash.
# This script complements the completion script that ships with git.

# Check that git tab completion is available
if declare -F _git > /dev/null; then
  # Duplicate and rename the 'list_all_commands' function
  eval "$(declare -f __git_list_all_commands | \
        sed 's/__git_list_all_commands/__git_list_all_commands_without_hub/')"

  # Wrap the 'list_all_commands' function with extra hub commands
  __git_list_all_commands() {
    cat <<-EOF
alias
pull-request
fork
create
browse
compare
EOF
    __git_list_all_commands_without_hub
  }

  # Ensure cached commands are cleared
  __git_all_commands=""
fi

source ~/.profile.d/git-completion

# Mac
if [[ FreeBSD == $(uname) ]] || [[ Darwin == $(uname) ]] ; then
  alias ls='ls -G'
  alias updatedb='sudo /usr/libexec/locate.updatedb'

  # homebrew
  PATH="/bin:/usr/local/bin:/usr/local/sbin:/usr/local/share/python:$PATH"
fi

# Project overrides: look for .aliases file in working directory
if [ -e ".aliases" ] ; then
  source .aliases
fi

# Local overrides
[ -f "$HOME/.profile_local" ] && source "$HOME/.profile_local"

# Current directory overrides
if [ -e ".profile_local" ] ; then
  source .profile_local
fi

# Project overrides: look for .aliases file in working directory
[ -f ".aliases" ] && source .aliases
