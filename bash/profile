# For local customization, add a file to ~/.profile.local
# We will export that at the end of this file.

export PAGER="less"
export EDITOR='atom -w'
export VPS='208.53.44.43'
export PS1='\u@\h:\[\033[0;31m\]\w\[\033[0;33m\]$(parse_git_branch)\[\e[0m\]$ '

# Shell
alias ls='ls --color'
alias less='less -R'
alias home='ssh -t jch@$VPS "screen -DR"'
alias hproxy='ssh -D 9999 $VPS'
alias clr="find . -name '*.rej' -or -name '*.orig' -or -name '*~' -or -name '*.lock' -and -not -name 'Gemfile.lock' | xargs rm -f"
alias emacs='emacs -nw'

# Mac
if [[ FreeBSD == $(uname) ]] || [[ Darwin == $(uname) ]] ; then
  alias ls='ls -G'
  alias updatedb='sudo /usr/libexec/locate.updatedb'
fi

# Rails
alias r="touch tmp/restart.txt"
alias b="bundle exec"
alias dbm='b rake db:migrate'
alias dbs='b rake db:setup'

# Heroku
alias h='heroku'

# Git
alias d='git diff --cached'
alias gd='git diff'
alias gm='git merge'

source ~/.profile.d/git-completion

# Brent's show branch on prompt
function parse_git_dirty {
  [[ $(git status 2> /dev/null | tail -n1) != "nothing to commit (working directory clean)" ]] && echo ""
}

function parse_git_branch {
  git branch --no-color 2> /dev/null | sed -e '/^[^*]/d' -e "s/* \(.*\)/[\1$(parse_git_dirty)]/"
}

# hub tab-completion script for bash.
# This script complements the completion script that ships with git.

# Check that git tab completion is available
if declare -F _git > /dev/null; then
  # Duplicate and rename the 'list_all_commands' function
  eval "$(declare -f __git_list_all_commands | \
        sed 's/__git_list_all_commands/__git_list_all_commands_without_hub/')"

  # Wrap the 'list_all_commands' function with extra hub commands
  __git_list_all_commands() {
    cat <<-EOF
alias
pull-request
fork
create
browse
compare
EOF
    __git_list_all_commands_without_hub
  }

  # Ensure cached commands are cleared
  __git_all_commands=""
fi

# Project overrides: look for .aliases file in working directory
[ -f ".aliases" ] && source .aliases

# Local overrides
[ -f "$HOME/.profile_local" ] && source ~/.profile_local
